name: Deploy ArtFlow System

on:
  push:
      branches: [ main ]
        pull_request:
            branches: [ main ]

            env:
              REGISTRY: ghcr.io
                IMAGE_NAME: ${{ github.repository }}

                jobs:
                  test:
                      runs-on: ubuntu-latest

                              steps:
                                  - uses: actions/checkout@v3

                                          - name: Set up Python 3.11
                                                uses: actions/setup-python@v4
                                                      with:
                                                              python-version: '3.11'
                                                                      cache: 'pip'

                                                                              - name: Install dependencies
                                                                                    run: |
                                                                                            python -m pip install --upgrade pip
                                                                                                    pip install -r requirements.txt
                                                                                                            pip install pytest pytest-cov flake8
                                                                                                                
                                                                                                                    - name: Lint with flake8
                                                                                                                          run: |
                                                                                                                                  # Stop the build if there are Python syntax errors or undefined names
                                                                                                                                          flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
                                                                                                                                                  # exit-zero treats all errors as warnings
                                                                                                                                                          flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics
                                                                                                                                                              
                                                                                                                                                                  - name: Run tests with pytest
                                                                                                                                                                        run: |
                                                                                                                                                                                pytest tests/ --cov=agents --cov=src --cov-report=xml --cov-report=html
                                                                                                                                                                                    
                                                                                                                                                                                        - name: Upload coverage to Codecov
                                                                                                                                                                                              uses: codecov/codecov-action@v3
                                                                                                                                                                                                    with:
                                                                                                                                                                                                            file: ./coverage.xml
                                                                                                                                                                                                                    fail_ci_if_error: false
                                                                                                                                                                                                                    
                                                                                                                                                                                                                      build-and-push:
                                                                                                                                                                                                                          needs: test
                                                                                                                                                                                                                              runs-on: ubuntu-latest
                                                                                                                                                                                                                                  permissions:
                                                                                                                                                                                                                                        contents: read
                                                                                                                                                                                                                                              packages: write
                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                      if: github.event_name == 'push' && github.ref == 'refs/heads/main'
                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                              steps:
                                                                                                                                                                                                                                                                  - uses: actions/checkout@v3
                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                          - name: Set up Docker Buildx
                                                                                                                                                                                                                                                                                uses: docker/setup-buildx-action@v2
                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                        - name: Log in to Container Registry
                                                                                                                                                                                                                                                                                              uses: docker/login-action@v2
                                                                                                                                                                                                                                                                                                    with:
                                                                                                                                                                                                                                                                                                            registry: ${{ env.REGISTRY }}
                                                                                                                                                                                                                                                                                                                    username: ${{ github.actor }}
                                                                                                                                                                                                                                                                                                                            password: ${{ secrets.GITHUB_TOKEN }}
                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                    - name: Extract metadata
                                                                                                                                                                                                                                                                                                                                          id: meta
                                                                                                                                                                                                                                                                                                                                                uses: docker/metadata-action@v4
                                                                                                                                                                                                                                                                                                                                                      with:
                                                                                                                                                                                                                                                                                                                                                              images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}
                                                                                                                                                                                                                                                                                                                                                                      tags: |
                                                                                                                                                                                                                                                                                                                                                                                type=ref,event=branch
                                                                                                                                                                                                                                                                                                                                                                                          type=semver,pattern={{version}}
                                                                                                                                                                                                                                                                                                                                                                                                    type=semver,pattern={{major}}.{{minor}}
                                                                                                                                                                                                                                                                                                                                                                                                              type=sha,prefix={{branch}}-
                                                                                                                                                                                                                                                                                                                                                                                                                        type=raw,value=latest,enable={{is_default_branch}}
                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                - name: Build and push Docker image
                                                                                                                                                                                                                                                                                                                                                                                                                                      uses: docker/build-push-action@v4
                                                                                                                                                                                                                                                                                                                                                                                                                                            with:
                                                                                                                                                                                                                                                                                                                                                                                                                                                    context: .
                                                                                                                                                                                                                                                                                                                                                                                                                                                            push: true
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    tags: ${{ steps.meta.outputs.tags }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            labels: ${{ steps.meta.outputs.labels }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cache-from: type=gha
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cache-to: type=gha,mode=max
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              deploy-staging:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  needs: build-and-push
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      runs-on: ubuntu-latest
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if: github.event_name == 'push' && github.ref == 'refs/heads/main'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  steps:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      - uses: actions/checkout@v3
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - name: Deploy to Staging
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    env:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            DEPLOY_KEY: ${{ secrets.DEPLOY_KEY_STAGING }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    DEPLOY_HOST: ${{ secrets.DEPLOY_HOST_STAGING }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            DEPLOY_USER: ${{ secrets.DEPLOY_USER_STAGING }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  run: |
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          mkdir -p ~/.ssh
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  echo "$DEPLOY_KEY" > ~/.ssh/deploy_key
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          chmod 600 ~/.ssh/deploy_key
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ssh-keyscan -H $DEPLOY_HOST >> ~/.ssh/known_hosts
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  # Deploy using SSH
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ssh -i ~/.ssh/deploy_key $DEPLOY_USER@$DEPLOY_HOST << 'EOF'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cd /home/$DEPLOY_USER/artflow
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              git pull origin main
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        docker-compose down
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  docker-compose pull
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            docker-compose up -d
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      docker-compose exec -T backend python -m pytest tests/ || echo "Tests completed with warnings"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              EOF
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      - name: Health Check
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            run: |
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    sleep 10
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            curl -f http://${{ secrets.DEPLOY_HOST_STAGING }}:5000/health || exit 1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              deploy-production:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  needs: deploy-staging
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      runs-on: ubuntu-latest
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if: github.event_name == 'push' && github.ref == 'refs/heads/main'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  steps:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      - uses: actions/checkout@v3
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - name: Wait for approval (optional)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    run: echo "Production deployment approved"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            - name: Deploy to Production
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  env:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          DEPLOY_KEY: ${{ secrets.DEPLOY_KEY_PROD }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  DEPLOY_HOST: ${{ secrets.DEPLOY_HOST_PROD }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          DEPLOY_USER: ${{ secrets.DEPLOY_USER_PROD }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                run: |
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        mkdir -p ~/.ssh
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                echo "$DEPLOY_KEY" > ~/.ssh/deploy_key
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        chmod 600 ~/.ssh/deploy_key
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ssh-keyscan -H $DEPLOY_HOST >> ~/.ssh/known_hosts
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                # Deploy using SSH with backup
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ssh -i ~/.ssh/deploy_key $DEPLOY_USER@$DEPLOY_HOST << 'EOF'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  cd /home/$DEPLOY_USER/artflow
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      # Create backup
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                docker-compose exec -T backend python -m agents.backup_manager backup
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    # Pull latest
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              git pull origin main
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  # Update containers
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            docker-compose down
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      docker-compose pull
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                docker-compose up -d
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        EOF
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - name: Production Health Check
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      run: |
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              sleep 15
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      for i in {1..5}; do
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                curl -f http://${{ secrets.DEPLOY_HOST_PROD }}:5000/health && break || sleep 10
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        done
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - name: Notify Slack
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      if: always()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            uses: 8398a7/action-slack@v3
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  with:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          status: ${{ job.status }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  text: 'Production deployment ${{ job.status }}'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          webhook_url: ${{ secrets.SLACK_WEBHOOK }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  fields: repo,message,commit,author
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    rollback:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        runs-on: ubuntu-latest
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if: failure() && github.event_name == 'push' && github.ref == 'refs/heads/main'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    steps:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - name: Rollback Production
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              env:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      DEPLOY_KEY: ${{ secrets.DEPLOY_KEY_PROD }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              DEPLOY_HOST: ${{ secrets.DEPLOY_HOST_PROD }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      DEPLOY_USER: ${{ secrets.DEPLOY_USER_PROD }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            run: |
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    mkdir -p ~/.ssh
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            echo "$DEPLOY_KEY" > ~/.ssh/deploy_key
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    chmod 600 ~/.ssh/deploy_key
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ssh-keyscan -H $DEPLOY_HOST >> ~/.ssh/known_hosts
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ssh -i ~/.ssh/deploy_key $DEPLOY_USER@$DEPLOY_HOST << 'EOF'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      cd /home/$DEPLOY_USER/artflow
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                git revert HEAD --no-edit
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          git push origin main
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    docker-compose restart
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            EOF
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - name: Notify Slack of Rollback
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if: always()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                uses: 8398a7/action-slack@v3
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      with:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              status: custom
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      custom_payload: |
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            text: 'Production rollback triggered due to deployment failure',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        status: 'danger'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          webhook_url: ${{ secrets.SLACK_WEBHOOK }}
